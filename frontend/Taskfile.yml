# https://taskfile.dev

version: '3'

dotenv:
  - ../.env
  - .env.local

tasks:
  playwright:install:
    desc: Install Playwright browser binaries (required for Storybook story tests and e2e tests)
    cmds:
      - pnpm exec playwright install

  playwright:install:chromium:
    desc: Install Playwright Chromium browser binary (required for Storybook story tests)
    cmds:
      - pnpm exec playwright install chromium

  dev:
    desc: Run Next.js development server
    cmds:
      - pnpm dev

  install:
    desc: Install dependencies
    cmds:
      - pnpm install

  lint:
    desc: Run Biome linter
    cmds:
      - pnpm lint

  format:
    desc: Format code using Biome
    cmds:
      - pnpm format

  check:
    desc: Check Biome rules and apply safe fixes (incl. formatting)
    cmds:
      - pnpm check

  check:unsafe:
    desc: Check Biome rules and apply all fixes (incl. unsafe and formatting)
    cmds:
      - pnpm check:unsafe

  check:types:
    desc: Run TypeScript type checker
    cmds:
      - pnpm check:types

  validate:
    desc: Run full validation suite (check + check:types + tests + storybook tests)
    cmds:
      - env -u NODE_ENV pnpm validate

  test:
    desc: Run unit/component tests (Vitest) in watch mode
    cmds:
      - pnpm test

  test:unit:
    desc: Run unit/component tests (Vitest) in watch mode
    cmds:
      - pnpm test:unit

  test:unit:run:
    desc: Run all unit/component tests (Vitest) once
    cmds:
      - pnpm test:unit:run

  test:unit:ui:
    desc: Run unit/component tests (Vitest) with interactive UI
    cmds:
      - pnpm test:unit:ui

  test:story:
    desc: Run Storybook story tests (Vitest browser mode via Playwright)
    deps: ["playwright:install:chromium"]
    cmds:
      - pnpm test:story

  test:story:run:
    desc: Run Storybook story tests once
    deps: ["playwright:install:chromium"]
    cmds:
      - pnpm test:story:run

  test:coverage:
    desc: Generate unit/component test (Vitest) coverage report
    cmds:
      - pnpm test:coverage

  test:e2e:
    desc: Run end-to-end tests (Playwright) headlessly
    deps: ["playwright:install"]
    cmds:
      - pnpm test:e2e

  test:e2e:report:
    desc: Show Playwright HTML report
    cmds:
      - pnpm test:e2e:report

  test:e2e:ui:
    desc: Run end-to-end tests (Playwright) with interactive UI
    cmds:
      - pnpm test:e2e:ui

  storybook:build:
    desc: Build Storybook static site
    cmds:
      - pnpm storybook:build

  storybook:dev:
    desc: Run Storybook development server
    cmds:
      - pnpm storybook:dev

  codegen:
    desc: Run GraphQL code generation
    cmds:
      - pnpm codegen
